# 工作总结
## 公司项目介绍
## 工作内容
   在公司担任PHP后端开发一职。负责修复项目的BUG，处理线上遇到的问题。以及项目的迭代开发，新需求的开发。线上项目稳定运行：保证正式云端服务，测试云端服务，正式环境，测试环境的正常可用。由于公司业务的性质，经常需要帮客户解决部署遇到的问题，以及在运行过程中会遇到的问题。
## 需求开发**（着重介绍）
``` 
项目重构：原来的项目是由PHP7.2版本和ThinkPHP5.1开发。由于需求的变更，增长以及人员流动，导致代码比较混乱，相互之间的非常耦合且不易于维护。于是重构到Hyperf框架上。因为是基于Swoole的协程框架。性能优于传统的FPM框架。（中途加入）。因为可以进行分布式部署，提高项目的可用性。且PHP版本升级到8.0，性能也有大的提升。将逻辑和调用分离。用组件化的形式规范项目。在Model层封装统一操作。

第三方对接：
1、微信第三方平台对接：对接微信小程序第三方平台，屏蔽细节操作，帮助公司商户用户快速开发和管理小程序。包含快速注册并绑定微信小程序，以及微信小程序的版本审核发布等一站式服务，简化用户的操作。使用了easywechat的组件，并优化其文件缓存为redis。数据库保存用户的授权相关字段，并简历索引，优化查询。
2、第三方平台智能设备对接（客制化）：对第三方平台的硬件设备进行对接，以方便对畜牧的养殖数据可视化。利用分层的思想，分离请求和业务逻辑，方便维护。封装用户数据和token以及请求信息。简历数据库，保存第三方用户信息，以提供单点登录功能。
3、第三方智能设备对接：整合用户和第三方平台，与第三方硬件厂商对接，目的在于，可以对畜牧进行绑定蓝牙耳标的操作，第三方通过配套硬件设置，获取到畜牧的数据并推送并保存。云端保存和同步第三方的硬件设备信息数据，客户添加设备时，在云端查询，没有云端没有这个数据时，进行同步第三方数据的操作，并加上redis锁和过期时间。如果不存在当前key，则缓存当前空key。用户在获取当前畜牧的日志记录时，查询第三方的数据并整理后返回。用户添加成功之后，在本地保存一份，作为选择耳标对畜牧下单时分配，使用redis锁和订单过期时间，以保证耳标设备的可用性。
需求开发：
1、用户标签：为了方便管理员对用户的行为进行可视化和后续的业务，开发赋予用户标签的，可手动标签和自动标签的方式进行赋予。手动标签即即时赋予用户相应的标签。自动标签通过选定时间段，对用户的某种或者某几种行为进行标注，通过redis定时队列的方式进行。会对所有的用户进行遍历并对满足用户的数据进行标注。
2、研学教育系统：为了丰富学生的课余生活和动手能力，以及联动公司项目，开发的一个，提供给学生，老师，家长使用的功能。在系统中认养某一个树，可以在现在对该树进行一系列相关的劳动。老师根据劳动的内容，给定不同的周期和分数。学生完成之后，通过图片的方式上传并提交作业。学生和家长都能够看到作业，以及评分。教师对同学的作业评分之后，根据设定的不同星级阈值，进行排行。


```

#### 可能会问的问题
为什么CLI模式会比传统的FPM模式性能更好
PHP版本升级带来的性能提升（notice：可能会问，为什么会有提升，哪方面的提升，是怎么做到的，你是怎么发现的）。
redis锁用的是什么锁，setnx锁
为什么那点不用mysql的行锁，要用redis锁呢？
## 遇到的问题（以及解决方案）
1、Hyperf是常驻内存，需要在Linux下开发：wsl下编译安装PHP,swoole扩展，redis，mysql
2、wsl下连接本地的数据库：通过ipconfig查看本地给wsl分配的地址，使用那个ip当成wsl本地服务
3、数据库要打开binlog日志，以保障数据的安全性。
4、在磁盘满了之后，如果开启了RDB和AOF持久化，会导致redis不可用
5、redis的端口应该改成非默认端口，并设置好密码和访问权限
6、数据库设置访问权限
7、不要相信用户的输入，一定要做参数校验，只取固定的字段和固定类型的值。
## 学到的东西
接触到了FPM以外的php开发方式。在Linux上手动构建开发环境以及 进行后续的开发。学习到了有问题的时候，先自己思考，再搜索，没搜到考虑关键词的问题。学会了，不要限制自己。