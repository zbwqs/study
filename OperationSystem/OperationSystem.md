# OS

1. 共享和并发是两个最基本的特征，并相互依存。
2. 并发的关键是进程之间的切换

## 程序并发
 宏观上是并发执行，微观上是多程序交替执行
 
## 进程（哈哈哈哈正在进行的程序）

三个状态：
1. 执行： 。。。
2. 阻塞： 等待资源或者I/O之类的。
3. 就绪： 获得执行条件，但是缺少处理机调度。

三个组成部分：
1. 程序： 自己对应的程序
2. 数据集合： 运行所需要的数据
3. PCB： （Process control Block）进程控制块。操作系统用于对进程的控制和管理。

## PCB

1. 进程标识符
   1. 内部标识符：如PID
   2. 外部表示符：wechat之类的名字
   3. 家族关系： 父子进程 
2. 处理机状态信息
   1. 当进程被处理机中断时，保存进程运行时产生并保存在寄存器的数据。
   2. 这组寄存器包括：基础寄存器，指令寄存器，程序状态字，用户堆栈指针
3. 进程调度信息
   1. 程序状态 ： 指明进程当前状态
   2. 进程优先级： 。。。
   3. 进程调度所需的资源： 。。。
   4. 事件： 进程阻塞的原因
4. 进程控制信息
   1. 进程和数据地址： 进程程序和数据所在的内存和外存地址
   2. 进程同步和通信机制 ：实现进程同步和进程通信时所必须的机制，如消息队列指针，信号量
   3. 资源清单 ： 所需和已分配的资源
   4. 链接指针 ： 本进程在就绪或阻塞队列中的PCB首地址

#### PCB队列
单 `cpu` 一次只能执行  一个进程。其他进程处于阻塞或就绪状态。用 `链表` 将这些程序的 `PCB` 链接起来。（对应上面的链接指针）。
并有`就绪队列`和`阻塞队列`之分。

## 进程调度
三级调度：`低级调度一定存在`
1. 高级调度 ： 决定把哪些程序从外存放入内存，并分配`内存` 和 `I/O` 资源
2. 中级调度 ： 当`内存` 空间不足时，把`就绪`或`阻塞`的进程交换到外存。反之则调入内存。
3. 低级调度 ： 选择`就绪`状态的进程放进`cpu`执行。（最频繁）

两种处理方式：
1. 抢占式：强行抢占
2. 非抢占式：。。。

调度算法：
1. 先来先服务 ： `按正常先后秩序，正常结束或者等待资源主动让出cpu`。**对短作业不公平**。因为短作业等的时间太长了，就执行那么一哈儿。找片半小时……
2. 时间片轮转 ： `算法分配固定时间片，用完就就绪或者阻塞。用户请求的作业也可分配高优先级`
3. 优先级 ： `进程分优先级，相同优先级则先来先服务` 
4. 多级任务队列 ： `要的越多等待地越久`

进程调度程序的功能：
1. 记录所有进程的相关信息，比如优先级，当前状态。
2. 确定分配算法
3. 分配处理机
4. 回收处理机

### 使用`原语`保证`创建进程`,`撤销进程`,`阻塞进程`,`唤醒进程`
步骤：
1. 关闭中断
2. 一系列操作
3. 打开中断

## JCB (job control block)
`作业控制块`：有自己的作业队列。只有通过`高级调度`把作业放在内存里，才参与与其他进程`竞争cpu`

三个状态：
1. 提交状态： 在`辅助存储器`
2. 后备状态： 高级调度到内存，并参与cpu竞争
3. 运行状态： 。。。
4. 完成状态： 撤销作业，回收资源，撤除JCB

作业调度算法：`注意审题是什么调度算法`
1. 周转时间： 完成时间 - 到达时间 `完成时间 = 到达时间 + 等待时间 + cpu占用时间 `
2. 平均周转时间： (n个周转时间之和)➗n
3. 加权周转时间: cpu占用时间➗周转时间
4. 平均加权周转时间：(n个加权周转时间之和)➗n


## windowsServer2008进程调度
进程：在以往的定义中，是资源分配的单位，以及处理机调度的单位
1. 资源分配的单位
   1. 进程包含自己的地址空间
   2. 地址空间包含：程序，数据 ，PCB，以及打开的文件，使用的信号量等
2. 资源拥有的单位
   1. 进程的创建、撤销、切换以及状态的变迁，系统要为此付出较大的时间和空间的开销
   2. 这不仅限制了进程的数目
   3. 也限制了进程的切换频率

解决办法：

为了解决`进程切换`导致`时空浪费`。让进程成为`资源拥有者`，并`赋予`出了进程新的实体--- 线程。负责`调度运行`

###  windowsServer2008 线程
线程是进程的一个`实体`。是`进程调度`和`运行`的基本单位。

如果进程是一个逻辑上的任务，那么线程就相当于可以`并发执行的`无数个子任务。

同一个`进程之间`的`线程切换`，无需跳出进程的地址空间，节省了系统的时空开销

### winSer 2008 中的进程和线程
进程描述（进程控制块 EPROCESS）：
1. 进程ID：唯一标识符
2. 安全标识符：包含创建者，可访问者，可使用者
3. 基本优先级
4. 内存管理信息
5. 执行时间：进程中所有线程所执行的时间的总和
6. 进程环境块
7. 链接指针：指向下一个进程控制块

线程描述
1. 线程ID
2. 动态优先级
3. 线程环境块
4. 指向所属进程的 进程控制块(EPROCESS)的指针
5. 线程类别：服务器线程，客户线程
6. 执行时间：本线程执行时间总和
7. I/O信息

线程的6中状态：
1. 就绪状态：`获得`了`所有所需资源`，就`等处理机`了
2. (插播一个知识，单CPU即单处理机；多CPU每一个都运行操作系统的复制，并可根据需要相互通信。多CPU是SMP)
   备用： 一个线程被某一个处理机选定为下次执行时，所处的状态。
   （如果这个备用状态的优先级很高，可能会抢占处理机）
3. 运行状态：正在运行的状态。
   1. 处理机被剥夺
   2. 时间片结束
   3. 请求I/O
   4. 等待资源被阻塞|终止。
   5. 1),2)两种情况，回到就绪态
4. 等待状态：等待I/O之类的事件
5. 转换状态：等待状态的条件被满足，但是缺乏运行所需资源
6. 终止状态：执行完成或者被其他线程干掉了

